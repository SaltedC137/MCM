# 问题三：多变量影响分析模型

## 1. 术语与参数定义

为确保数学严谨性，我们定义问题三模型中使用的符号和参数集。

| 符号 | 定义 | 类型/维度 | 描述 |
|:--- |:--- |:--- |:--- |
| $Y_{Judge}$ | 目标：评委得分 | 实数 $\in [0, 40]$ | 代表评委技术评分的因变量。 |
| $Y_{Fan}$ | 目标：粉丝投票 | 实数 $\in [0, 1]$ | 代表估算粉丝投票份额的因变量。 |
| $Y_{Rank}$ | 目标：周排名 | 整数 $\in [1, N_w]$ | 代表选手在当周排名的因变量。 |
| $X_{Season}$ | 特征：赛季ID | 整数 | 捕捉宏观时间趋势（如收视率下降、规则变更）。 |
| $X_{Week}$ | 特征：周次 | 整数 | 代表赛季内的进程（学习曲线、幸存者偏差）。 |
| $X_{Age}$ | 特征：选手年龄 | 整数 | 名人选手的年龄。 |
| $X_{Partner}$ | 特征：职业舞伴 | 分类变量 | 与名人搭档的职业舞者。 |
| $X_{Industry}$ | 特征：所属行业 | 分类变量 | 名人的职业背景（如演员、运动员）。 |
| $\phi_{i, j}$ | SHAP值 | 实数 | 特征 $j$ 对样本 $i$ 预测值的贡献度。 |
| $R^2$ | 决定系数 | 实数 $\in [0, 1]$ | 评估 XGBoost 模型解释能力的指标。 |

---

## 2. XGBoost 回归框架

我们采用 **XGBoost (Extreme Gradient Boosting)** 作为核心分析引擎。与线性回归不同，XGBoost 能够捕捉复杂的非线性交互作用（例如“年龄在赛季后期更重要”）并有效处理分类变量。

### 2.1. 模型设定
对于每个目标变量 $Y \in \{Y_{Judge}, Y_{Fan}, Y_{Rank}\}$，我们训练一个独立的回归器：

$$ \hat{Y} = \sum_{k=1}^{K} f_k(X_i), \quad f_k \in \mathcal{F} $$

*   **目标函数**：我们最小化带有正则化项的平方误差损失以防止过拟合：
    $$ \mathcal{L}(\phi) = \sum_i (y_i - \hat{y}_i)^2 + \sum_k \Omega(f_k) $$
*   **超参数**：
    *   `n_estimators=100`: 提升轮数。
    *   `learning_rate=0.1`: 步长收缩。
    *   `max_depth=5`: 最大树深，用于捕捉特征交互。

### 2.2. 模型性能验证
我们的模型取得了稳健的预测性能，验证了其用于影响分析的可靠性：

*   **粉丝投票模型 ($R^2 = 0.94$)**：准确率极高。这表明粉丝投票模式具有高度的结构性和可预测性，主要由宏观因素（赛季）驱动。
*   **评委得分模型 ($R^2 = 0.63$)**：中高准确率。评委评分主要由客观因素（周次、舞伴）决定，但也存在主观方差。
*   **周排名模型 ($R^2 = 0.39$)**：准确率较低。排名是一个依赖于具体对手的相对指标，仅凭绝对特征较难预测。

---

## 3. SHAP 解释机制

为了打开 XGBoost 的“黑箱”，我们利用 **SHAP (SHapley Additive exPlanations)** 值。考虑到库的兼容性，我们实现了一个稳健的 **置换解释器 (Permutation Explainer)** 作为后备机制。

### 3.1. SHAP值定义
SHAP值 $\phi_{i, j}$ 代表特征 $j$ 对样本 $i$ 预测值的边际贡献，满足博弈论的一致性和局部准确性性质。

$$ \hat{f}(x) = \phi_0 + \sum_{j=1}^{M} \phi_j $$

### 3.2. 特征重要性量化
我们将特征 $j$ 的全局重要性定义为所有样本绝对 SHAP 值的平均值：

$$ I_j = \frac{1}{N} \sum_{i=1}^{N} |\phi_{i, j}| $$

该指标允许我们直接比较不同特征（例如“年龄是否比行业更重要？”）在不同目标上的影响。

---

## 4. 关键发现

### 4.1. 驱动力分歧：评委 vs. 粉丝
我们的分析揭示了比赛中存在根本性的“双重标准”：

*   **评委评分驱动力**：
    *   **主要驱动力：周次 ($X_{Week}$)**。评委奖励坚持和技术成长。随着赛季深入，由于幸存者偏差（只有优秀舞者留下）和学习效应，分数自然膨胀。
    *   **次要驱动力：舞伴 ($X_{Partner}$)**。优秀的职业舞伴能显著提升名人的技术分。
*   **粉丝投票驱动力**：
    *   **主导驱动力：赛季 ($X_{Season}$)**。宏观环境（如节目收视率、观众趋势）压倒性地决定了粉丝投票的总量。这解释了在Q2中观察到的“赢家通吃”现象。
    *   **次要驱动力：无**。与全赛季趋势相比，年龄或行业等个人属性的影响微乎其微。

### 4.2. 排名中的年龄因素
*   虽然 **年龄 ($X_{Age}$)** 对绝对的评委分或粉丝票影响有限，但它成为 **周排名 ($Y_{Rank}$)** 的关键决定因素。
*   *解释*：在排名的相对竞争中，体能和灵活性（与年轻相关）提供了决定性的优势，将顶层选手与中层选手区分开来。

### 4.3. 行业影响
*   与普遍看法相反，**名人所属行业 ($X_{Industry}$)** 的作用较小。选手是运动员还是演员，其重要性远不如他们身处哪个赛季或坚持到了第几周。
