# 问题二：组合方法对比模型——因果推断增强型仿真模型

## 1. 模型概述

为了深入分析《与星共舞》（DWTS）节目历史上使用的两种主要计分规则（Rank法与Percentage法）及其改进版（Judges' Save机制）对比赛结果的影响，我们构建了一个**“因果推断增强型仿真模型”（Causal Inference Enhanced Simulation Model）**。

该模型的核心思想是建立“平行世界”（Parallel Worlds）：让每一位参赛选手在相同的赛季、相同的周次、相同的表现（评委分与粉丝票）下，分别接受三种不同规则的裁决。通过这种反事实（Counterfactual）模拟，我们能够严格控制干扰变量（如赛季选手的整体实力波动），从而精确量化规则本身的偏向性。

此外，为了从黑盒的模拟结果中提炼出量化指标，我们引入了**图神经网络（GNN）**作为代理模型，通过特征扰动分析（Feature Perturbation Analysis）计算了不同规则下“粉丝投票”对最终淘汰结果的贡献度（Bias Score）。

---

## 2. 仿真引擎逻辑 (`q2_simulation_plus.py`)

我们的仿真引擎严格复现了题目描述的三种计分机制。对于数据集中的每一个有效样本点（Season $s$, Week $w$, Contestant $i$），我们计算其在三种规则下的命运。

### 2.1. 符号定义

*   $S_{J, i}$: 选手 $i$ 的评委得分（Judge Score）。
*   $V_{F, i}$: 选手 $i$ 的粉丝投票估算值（Estimated Fan Vote，源自问题一模型）。
*   $R_{J, i}$: 评委得分排名（1为最高分/最优）。
*   $R_{V, i}$: 粉丝投票排名（1为最高票/最优）。
*   $P_{J, i}$: 评委得分占比（Share）。
*   $P_{V, i}$: 粉丝投票占比（Share）。

### 2.2. 平行世界一：排名法 (Rank Method)

此规则应用于 Season 1-2 及 Season 28+。规则核心是“排名之和最小者优”。

*   **组合得分**：
    $$ C_{Rank, i} = R_{J, i} + R_{V, i} $$
*   **淘汰规则**：
    $$ \text{Eliminated} = \arg\max_{i} (C_{Rank, i}) $$
    *   *平局判定*：若组合得分相同，则粉丝排名 $R_{V, i}$ 较差者被淘汰（模拟代码中通过排序键 `[C_Rank, R_V]` 实现）。

### 2.3. 平行世界二：百分比法 (Percentage Method)

此规则应用于 Season 3-27。规则核心是“总占比最低者淘汰”。

*   **组合得分**：
    $$ C_{Pct, i} = \frac{S_{J, i}}{\sum_k S_{J, k}} + \frac{V_{F, i}}{\sum_k V_{F, k}} $$
*   **淘汰规则**：
    $$ \text{Eliminated} = \arg\min_{i} (C_{Pct, i}) $$

### 2.4. 平行世界三：法官拯救机制 (Judges' Save)

此规则应用于 Season 28+。它在排名法的基础上增加了“底部二选一”环节，引入了法官的主观能动性。

*   **第一步：确定底部两名 (Bottom Two)**
    根据 $C_{Rank, i}$ 排序，选出最差的两位选手 $\{c_1, c_2\}$。
*   **第二步：概率性拯救 (Probabilistic Save)**
    我们构建了一个 Logit 模型来模拟法官的决策。法官倾向于拯救专业得分更高的选手，但并非绝对（存在不确定性）。设 $c_1$ 为评委分较低者，$c_2$ 为评委分较高者。
    
    $c_1$ 被淘汰的概率 $P(Elim\_c_1)$ 定义为：
    $$ P(Elim\_c_1) = \frac{S_{J, c_2}}{S_{J, c_1} + S_{J, c_2}} $$
    
    *   *逻辑解释*：如果对手 $c_2$ 的评委分极高（强行压制），那么 $c_1$ 被淘汰的概率就趋近于 1；如果两人分数接近，概率趋近于 0.5。
    *   *仿真实现*：使用 `np.random.random()` 进行蒙特卡洛判定。

---

## 3. 偏向性量化分析 (`q2_causal_gnn.py`)

为了回答“哪种方法更偏向粉丝投票”这一核心问题，我们不能仅凭直觉。我们构建了一个 GNN 代理模型来“阅读”仿真结果，并提炼出特征重要性。

### 3.1. 图神经网络 (GNN) 构建

我们将每一周的比赛建模为一个**全连接竞争图 (Fully Connected Competition Graph)**。
*   **节点 (Nodes)**：参赛选手。
*   **边 (Edges)**：选手之间的竞争关系（全连接）。
*   **特征 (Features)** $X$: `[Judge_Score_Norm, Fan_Vote_Norm, Industry_Code]`。
*   **目标 (Target)** $Y$: 在特定规则下是否被淘汰 (0/1)。

模型架构采用 **GraphSAGE** (SAGEConv)，因为它能很好地捕捉节点在邻域（即对手环境）中的相对地位：
$$ h_i^{(l+1)} = \sigma \left( W \cdot \text{CONCAT}(h_i^{(l)}, \text{AGG}(\{h_j^{(l)}, \forall j \in \mathcal{N}(i)\})) \right) $$

### 3.2. 粉丝偏向性得分 (Fan Bias Score)

由于无法直接使用 SHAP 库（环境限制），我们实现了**基于特征扰动 (Permutation Importance)** 的归因分析算法：

1.  **训练代理**：针对每种规则（Rank, Pct, Save），训练一个 GNN 拟合该规则的淘汰逻辑。
2.  **基准预测**：记录模型在原始数据上的预测输出。
3.  **特征扰动**：
    *   将所有样本的“评委分”列随机打乱，计算预测差异 $\Delta_{Judge}$。
    *   将所有样本的“粉丝票”列随机打乱，计算预测差异 $\Delta_{Fan}$。
4.  **偏向性得分**：
    $$ \text{Bias Score} = \frac{\Delta_{Fan}}{\Delta_{Fan} + \Delta_{Judge}} $$
    *   若 Score > 0.5，说明粉丝票对结果的影响力超过了评委分。

---

## 4. 实验结果与分析

基于全量历史数据的仿真与分析，我们得出了以下关键结论：

### 4.1. 方法偏向性对比

| 计分方法 | Fan Bias Score | 解释 |
| :--- | :--- | :--- |
| **Percentage Method** | **0.77** | **极度偏向粉丝**。由于粉丝投票通常服从幂律分布（头部效应显著），高人气选手的票仓优势极其巨大，评委分很难扭转局面。 |
| **Rank Method** | **0.64** | **偏向粉丝**。将票数线性化为排名后，削弱了头部选手的“统治力”，但粉丝权重依然略高于评委。 |
| **Judges' Save** | **0.53** | **最平衡**。引入法官拯救机制后，偏向性得分几乎回到了 0.5 的理想平衡点，有效拦截了“高人气低实力”的选手。 |

### 4.2. 争议案例反事实推演 (Counterfactual Timeline)

针对 Season 27 冠军 **Bobby Bones**（著名的“低分高人气”选手），我们的平行世界仿真显示：
*   **在 Percentage 规则下**（历史真实情况）：他从未被淘汰，一路夺冠。
*   **在 Rank 规则下**：他在部分周次面临极高风险，但依然勉强存活。
*   **在 Judges' Save 规则下**：**他在 Week 8（半决赛）被淘汰的概率极高**。因为在那一周，他进入了 Bottom Two，且评委分远低于对手，法官大概率会行使拯救权淘汰他。

### 5. 结论

**Judges' Save 机制是修补赛制漏洞的最佳方案。** 它在保留粉丝参与感的同时，赋予了专业评委在关键时刻（Bottom Two）的“一票否决权”，从而避免了极端的“流量冠军”现象，保证了比赛的专业性和公平性。
