# 组合方法对比模型——因果推断增强型仿真模型

## 1. 术语与参数定义

为确保数学严谨性，我们定义问题二模型中使用的符号和参数集。

| 符号 | 定义 | 类型/维度 | 描述 |
|:--- |:--- |:--- |:--- |
| $S_{J, i}$ | 评委得分 | 实数 $\in [0, 40]$ | 选手 $i$ 的原始评委得分。 |
| $V_{F, i}$ | 粉丝投票估算值 | 实数 $\in [0, 1]$ | 选手 $i$ 的粉丝投票估算值（源自问题一模型）。 |
| $R_{J, i}$ | 评委排名 | 整数 $\in [1, N_w]$ | 基于评委分数的排名（1为最高分）。 |
| $R_{V, i}$ | 粉丝排名 | 整数 $\in [1, N_w]$ | 基于粉丝投票的排名（1为最高票）。 |
| $C_{Rank, i}$ | 排名法组合得分 | 整数 | 排名法下的组合得分 ($R_{J, i} + R_{V, i}$)。 |
| $C_{Pct, i}$ | 百分比法组合得分 | 实数 $\in [0, 2]$ | 百分比法下的组合得分。 |
| $P(Elim|i)$ | 淘汰概率 | 实数 $\in [0, 1]$ | 在法官拯救机制下被淘汰的概率。 |
| $Bias_{Method}$ | 粉丝偏向性得分 | 实数 $\in [0, 1]$ | 基于GNN计算的粉丝投票对结果的贡献度。 |
| $\mathcal{G}_w$ | 竞争图谱 | 图结构 | 第 $w$ 周比赛的图表示。 |
| $\Delta_{Fan}$ | 扰动误差 | 实数 | 打乱粉丝票时的模型误差增量。 |

---

## 2. 平行世界仿真逻辑

我们构建“平行世界”来模拟每位选手在三种不同规则下的命运，同时保持其表现数据（$S_{J, i}, V_{F, i}$）不变。这种反事实方法使我们能够分离出投票机制本身的影响。

### 2.1. 平行世界一：排名法 (The Rank Method)
*应用于赛季 1-2, 28+*

在这个世界中，我们模拟“秩和”逻辑。总和越低越好。

*   **数据变换**:
    *   $R_{J, i} = \text{Rank}(S_{J, i})$ 降序（最高分 $\to$ 排名 1）。
    *   $R_{V, i} = \text{Rank}(V_{F, i})$ 降序（最高票 $\to$ 排名 1）。
*   **机制**:
    $$ C_{Rank, i} = R_{J, i} + R_{V, i} $$
*   **淘汰规则**:
    组合得分 $C_{Rank, i}$ **最高**（排名总和最差）的选手被淘汰。
    $$ \text{Eliminated} = \arg\max_{i} (C_{Rank, i}) $$
*   **平局判定**:
    若 $C_{Rank, i} = C_{Rank, j}$，则粉丝排名（$R_{V}$）较差者被淘汰。

### 2.2. 平行世界二：百分比法 (The Percentage Method)
*应用于赛季 3-27*

在这个世界中，我们模拟“比例份额”逻辑。份额越高越好。

*   **数据变换**:
    *   $P_{J, i} = \frac{S_{J, i}}{\sum_{k \in C_w} S_{J, k}}$
    *   $P_{V, i} = \frac{V_{F, i}}{\sum_{k \in C_w} V_{F, k}}$
*   **机制**:
    $$ C_{Pct, i} = P_{J, i} + P_{V, i} $$
*   **淘汰规则**:
    组合得分 $C_{Pct, i}$ **最低**（总占比最小）的选手被淘汰。
    $$ \text{Eliminated} = \arg\min_{i} (C_{Pct, i}) $$

### 2.3. 平行世界三：法官拯救机制 (The Judges' Save)
*赛季 28+ 的改进规则*

这个世界引入了一个随机成分来模拟人类决策（法官的干预）。

*   **第一步：确定倒数两名**
    我们首先像平行世界一那样计算排名组合得分 $C_{Rank}$。得分最高的两名选手被认定为“倒数两名”集合 $\mathcal{B} = \{c_1, c_2\}$。
*   **第二步：概率性拯救建模**
    我们利用基于评委分差的 **Logit 模型** 来模拟法官决策。我们假设法官倾向于拯救技术分（$S_J$）更高的选手，但决策具有概率性。
    
    设 $c_1$ 为倒数两名中评委分较低的选手。$c_1$ 被淘汰的概率为：
    
    $$ P(Elim\_c_1) = \text{Sigmoid}(\beta \cdot (S_{J, c_2} - S_{J, c_1})) \approx \frac{S_{J, c_2}}{S_{J, c_1} + S_{J, c_2}} $$
    
    *   *解释*：如果对手 $c_2$ 的评委分显著更高，则 $c_1$ 被淘汰的概率趋近于 1。
    *   *实现*：我们使用蒙特卡洛采样 (`np.random.random()`) 来根据此概率确定结果。

---

## 3. 基于GNN代理的偏向性量化

为了量化“哪种方法更偏向粉丝投票”而不依赖主观观察，我们训练一个 **图神经网络 (GNN)** 来学习从特征到淘汰结果的隐式映射。

### 3.1. 模型架构

我们将每周的比赛建模为一个全连接图 $\mathcal{G}_w = (\mathcal{V}_w, \mathcal{E}_w)$，其中节点代表选手。

*   **节点特征**: $X_i = [\text{Norm}(S_{J, i}), \text{Norm}(V_{F, i}), \text{IndustryCode}_i]$。
*   **边结构**: 全连接（每位选手都与所有其他选手竞争）。
*   **GNN 层**: 我们使用 **GraphSAGE** (SAGEConv) 层。GraphSAGE 聚合邻居信息，有效地捕捉了选手相对于同行的*相对*地位（这对排名系统至关重要）。
    $$ h_i^{(l+1)} = \sigma \left( W \cdot \text{CONCAT}(h_i^{(l)}, \text{AGG}(\{h_j^{(l)}, \forall j \in \mathcal{N}(i)\})) \right) $$
*   **目标**: 基于仿真基准真值的二分类（1 = 淘汰，0 = 安全）。

### 3.2. 特征扰动分析 (SHAP的代理)

由于直接计算 GNN 的 SHAP 值计算成本高昂，我们实现了一种 **置换特征重要性 (Permutation Feature Importance)** 算法来量化偏向性。

1.  **基准**: 计算模型在原始数据集上的预测误差 (MSE)。
2.  **扰动粉丝票**: 在整个数据集中随机打乱 $V_{F}$ 列，并测量误差的增加量 ($\Delta_{Fan}$)。这破坏了粉丝票特征中的信息。
3.  **扰动评委分**: 随机打乱 $S_{J}$ 列并测量误差的增加量 ($\Delta_{Judge}$)。
4.  **偏向性得分计算**:
    $$ \text{Bias Score} = \frac{\Delta_{Fan}}{\Delta_{Fan} + \Delta_{Judge}} $$
    *   得分 $\to 1$: 该方法由粉丝投票主导。
    *   得分 $\to 0$: 该方法由评委分数主导。
    *   得分 $\approx 0.5$: 该方法是平衡的。

---

## 4. 关键结果

### 4.1. 偏向性得分对比

| 方法 | 偏向性得分 | 结论 |
| :--- | :--- | :--- |
| **百分比法 (Percentage)** | **0.77** | **赢家通吃**。偏向性得分显著大于 0.5，表明对粉丝人气的极度敏感。由于粉丝投票服从齐普夫分布（Zipfian distribution），顶级明星积累了巨大的选票份额，压倒了评委分数。 |
| **排名法 (Rank)** | **0.64** | **线性化**。得分下降但仍大于 0.5。排名将选票分布线性化，抑制了“超级巨星效应”，但粉丝影响力仍是主要的。 |
| **法官拯救 (Judges' Save)** | **0.53** | **平衡**。得分接近 0.5。法官在最后一步的“否决权”有效地中和了粉丝偏向，恢复了专业标准。 |

### 4.2. 反事实案例分析：Bobby Bones (S27)

*   **真实历史（百分比法）**：Bobby Bones 赢得了第27季冠军。我们的仿真确认，在该规则下，尽管评委分很低，他的淘汰风险为 **0%**。
*   **仿真结果（法官拯救）**：在我们的平行世界仿真中，Bobby Bones 在 **第8周面临极高的淘汰风险**。
    *   *机制*：在第8周，他的低评委分将他置于倒数两名。我们的 Logit 模型预测，法官有极高概率拯救他的对手（技术分更高）。
    *   *结论*：法官拯救机制很可能阻止“Bobby Bones 争议”。
